---
title: Documentation
---

<DocsSidebar/>

<DocsContent>

<DocsArticle id="getting-started">

# Getting Started

<DocsSection id="install">

## Install

#### Software Requirements

`node` >= 12 (LTS only), `yarn` >= 1.20, and `docker` >= 19.

We rely on `yarn` workspaces, and `npm` does not support them yet.

Our development is mostly on Linux. Best platform for running `docker` containers.

#### Download

Clone the main repository

```shell
git clone https://github.com/cafjs/caf.git
```

Update submodules

```shell
cd caf; git submodule update --init
```

Install dependencies

```shell
yarn run installAll
```

Add to your path the `cafjs` tool binary

```shell
export PATH=<your_install_directory>/caf/bin:$PATH
```

Download the latest `docker` images

```shell
cafjs update
```

#### Test

Let's build and run locally a simple app.


```shell
cd apps/caf_helloworld; cafjs build; cafjs run helloworld
```

With `docker ps` you should see seven running containers. They simulate the support services that we run in the Cloud.

The app launcher URL is http://root-launcher.vcap.me (DNS resolves `*.vcap.me` to `127.0.0.1`, the local loop). Using your browser, login with user `foo` and password `bar`. Then, with the top left menu, click the `+` icon to add a `helloworld` app instance.

Fill the form with:

* App publisher: `root` (in local mode apps are always published by `root`)
* App name: `helloworld`
* CA name: anything containing ASCII characters and numbers.

and a `counter` example should appear. Use the `+` again to create other instances, and then switch between them with the top left menu.

To stop it, a single `Control-C` will initiate a gentle container shutdown but, for the impatient, a second `Control-C` will brute force a clean-up. Double tap.

In both cases we should be able to restart without losing the previous state, since the Redis container generates a checkpoint file in the host diretory `/tmp`. Delete this file to start from scratch:

```shell
sudo rm /tmp/redis/appendonly.aof
```

</DocsSection>

<DocsSection id="headless-example">

## Your First App

Let's create a simple app with no front end.

*Caf.js* is managed as a monorepo using `yarn` workspaces. Anything under the sub-directory `caf/playground/app` becomes part of the workspace, and we will create the app there.

Using a monorepo has many advantages, but the most important one is that you know what you are getting. When we create a release of *Caf.js* we freeze all our packages, and test them together. Your app will not suffer from semver mistakes due to these packages.

To create the app skeleton we use `cafjs generate`, an application template generator. The default templates are in a Docker image, and it is easy to customize and share your templates by publishing a new image. See  <Link to="#tools">Tools</Link> for details.

```shell
cd playground; rm -fr app;  cafjs generate myapp cloud ./app
```

and then install, build, and run. Install is only needed for the first build, to update dependencies in the monorepo.

```shell
cd app; cafjs install; cafjs build;  cafjs run -d myapp
```

This time we used the flag `-d` to turn on debugging mode. You should see debug logs in the console. It also opens the debug port `9229`, and you can set breakpoints, and inspect variables, with the Chrome browser developer tools (`chrome://inspect`). The *Redis* instance is also accessible in host port `6380`.

There is no front end, and we use a script in the `util` directory to read state, and subscribe to notifications.

```shell
cd util; ./client.js --url http://root-myapp.vcap.me bar foo-ca1
```

What is in the box?

We will use this example to introduce *Caf.js* programming in the <Link to="#concepts">next</Link> section. Let's look at the files in the `lib` directory first:

* `rsa_pub.pem` A dummy public key to validate authentication tokens in a local deployment. When you deploy your app in the *Caf.js Cloud*, we swap this key by the "real" one.
* `framework++.json` Describes changes to the baseline platform configuration in <Link to="../../apis/#caf_platform">framework.json</Link>.
* `ca++.json` Describes changes to the baseline cloud assistant configuration in <Link to="../../apis/#caf_ca">ca.json</Link>.
* `ca_methods.js` Your code.

To understand the json files have a look at our <Link to="#components">component model</Link>. Sections <Link to="#cloud-assistant">Cloud Assistant</Link> and <Link to="#autonomous">Autonomous Computation</Link> cover `ca_methods.js`. The script is explained in the <Link to="#client">Client Library</Link>.

</DocsSection>

<DocsSection id="add-react-frontend">

## Add a React User Interface

Let's add a *React* front end to the previous app.

```shell
cd playground; rm -fr app;  cafjs generate myapp web ./app
```
and again:

```shell
cd app; cafjs install; cafjs build;  cafjs run -d myapp
```

and now, as we did for testing the <Link to="#install">installation</Link>, login with the browser, and create a few instances with app name `myapp`, and `root` publisher, since we are in local mode.

The app uses <Link to="/autonomous">Proactive Server Side Rendering (PSSR)</Link> for fast app switching. The json files add the required <Link to="../../apis/#caf_react">React plugin</Link>.  In `ca_methods.js` there is also a new method `hello()`, which provides the cache key for rendering, and a few calls to the new plugin. Without PSSR the cloud code would look similar to the previous example.

The code in `public` is mostly a standard `React` app, which uses `redux` to manage state, and `react-bootstrap` components to build the UI.

The only novelty is a session object to connect to a cloud assistant in `AppSession.js`, binding actions to remote methods in `AppActions.js`, and a custom initialization in `app.js`.

These are **not** strong dependencies. This is just an example integrating *Caf.js* with a front end, using libraries that we are familiar with. Replacing `React` by another framework would require a new plugin for PSSR. Replacing `redux` by other state management solution just needs a simple integration with the client library, as in `AppActions.js`. There are no *Caf.js* dependencies with `react-bootstrap`.


</DocsSection>

<DocsSection id="add-device">

## Add a Device

</DocsSection>

<DocsSection id="three-way-isomorphic">

## Three-way Isomorphic

</DocsSection>

With the `cafjs` command we can also create apps from templates, simulate devices, build container images to publish in our cloud service, i.e., https://root-launcher.cafjs.com, or reset after a hang. See {@link external:caf_dcinabox} (https://cafjs.github.io/api/caf_dcinabox) for details.
</DocsArticle>


<DocsArticle id="concepts">

# Concepts

<DocsSection id="components">

## Components

```js
exports.newInstance = async function($, spec) {
    let isShutdown = false;
    const that = {
        hello() {
            !isShutdown && console.log(spec.name + ':' + spec.env.msg);
        },
        async __ca_checkup__(data) {
            return isShutdown ? [new Error('Shutdown')] : [];
        },
        async __ca_shutdown__(data) {
            isShutdown = true;
            $ && ($[spec.name] === that) && delete $[spec.name];
            return [];
        }
    };
    return [null, that];
};
```

</DocsSection>


<DocsSection id="cloud-assistant">

## Cloud Assistant

</DocsSection>


<DocsSection id="autonomous">

## Autonomous Computation

</DocsSection>

<DocsSection id="client">

## Client Library

</DocsSection>

<DocsSection id="trusted-bus">

## Trusted Bus

</DocsSection>

<DocsSection id="sharing-actors">

## Sharing Actors

</DocsSection>

<DocsSection id="publish-subscribe">

## Publish-Subscribe

</DocsSection>

<DocsSection id="iot-device">

## IoT Device

</DocsSection>

</DocsArticle>

<DocsArticle id="apis">

# APIs

You can see the jsdoc documentation <Link to="/apis">here</Link>
</DocsArticle>

<DocsArticle id="tools">

# Tools

</DocsArticle>
<DocsArticle id="resources">

# Resources

</DocsArticle>

</DocsContent>
